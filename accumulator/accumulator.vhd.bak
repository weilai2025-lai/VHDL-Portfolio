-- 1. 函式庫 (Library) 宣告
library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;

-- 2. 實體 (Entity) 宣告：定義模組的 "外觀"
entity accumulator is
    -- 3. 泛型 (Generic) 宣告：對應 Verilog 的 parameter
    generic (
        width : integer := 32
    );
    -- 4. 埠 (Port) 宣告：定義輸出入訊號
    port (
        clk     : in  std_logic;
        rst     : in  std_logic;
        w_en    : in  std_logic;
        acc_out : out std_logic_vector(width-1 downto 0)
    );
end entity accumulator;

-- 5. 架構 (Architecture) 主體：描述模組的 "行為"
architecture behavioral of accumulator is
    -- 6. 內部訊號 (Signal) 宣告
    signal acc_out_s : unsigned(width-1 downto 0);
begin
    -- 7. 處理程序 (Process) 區塊：對應 Verilog 的 always 區塊
    process(clk)
    begin
        -- 8. 偵測時脈邊緣
        if rising_edge(clk) then
            -- 9. 同步重置邏輯
            if rst = '1' then
                acc_out_s <= (others => '0');
            -- 10. 累加邏輯
            else
                if w_en = '1' then
                  acc_out_s <= acc_out_s + 1;
                end if;
            end if;
        end if;
    end process;

    -- 11. 訊號連接
    acc_out <= std_logic_vector(acc_out_s);

end architecture behavioral;